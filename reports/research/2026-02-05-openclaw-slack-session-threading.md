---
layout: default
title: "OpenClaw Slackセッション管理調査"
parent: Research
date: 2026-02-05
---

# OpenClaw Slackセッション管理調査

**作成日:** 2026-02-05
**タイプ:** 技術調査
**元ソース:**
- [Session Management - OpenClaw](https://docs.openclaw.ai/concepts/session)
- [Slack - OpenClaw](https://docs.openclaw.ai/channels/slack)

---

## 📝 概要

SlackでOpenClawとやり取りする際に、スレッドごとにセッションを分ける方法について調査した。

---

## 🎯 結論

### デフォルトの動作

OpenClawのデフォルトでは：
- **DMs**: 1つのメインセッション（`session.mainKey`）で継続
- **チャンネル**: チャンネル単位でセッションが分かれる
- **スレッド**: チャンネル内のスレッドは同じセッションとして扱われる

### セッションキーの形式

| 種類 | セッションキー形式 | 説明 |
|--------|----------------|--------|
| DM | `agent:<agentId>:<mainKey>` | 全てのDMが共通のセッションで継続 |
| チャンネル | `agent:<agentId>:slack:channel:<channelId>` | チャンネル単位でセッション分離 |
| スレッド | スレッドIDは記録されるが、デフォルトではチャンネルと同じセッション | SlackのthreadIdがoriginメタデータに含まれる |

### Telegramとの違い

Telegramではスレッドごとのセッション分けがネイティブにサポートされています：
```
agent:<agentId>:slack:channel:<channelId>:topic:<threadId>
```

しかし、Slackのドキュメントにはスレッドごとのセッション分けの方法が記述されていません。

---

## 🛠️ スレッドごとにセッションを分ける方法

### 方法1: `/new` コマンドを使用（手動）

新しいスレッドで新しいセッションを開始する場合：
```
/new
```

これで新しいセッションIDが生成され、そのスレッドでの対話は新しいセッションとして扱われます。

### 方法2: チャンネル設定で制限

Slackのチャンネル設定で、スレッドの挙動を制御できます：

```json
{
  "channels": {
    "slack": {
      "replyToMode": "all",  // 全ての返信をスレッド内にする
      // または
      "replyToModeByChatType": {
        "channel": "all"  // チャンネルでの返信をスレッド内にする
      }
    }
  }
}
```

ただし、これは返信の表示方法を制御するだけで、セッション自体の分離には繋がりません。

### 方法3: タスクごとに異なるチャンネルを使用（推奨）

スレッドごとにセッションを分けるというよりは、タスクごとに専用のチャンネルを作成するのが確実です：

| 方法 | メリット | デメリット |
|------|----------|-----------|
| スレッドごとにチャンネル | 明確なセッション分離、履歴が見やすい | チャンネルが増える |
| スレッドで /new 手動実行 | チャンネル数を増やさない | 手動操作が必要 |
| エージェント別設定 | 設定による自動制御 | 複雑な設定が必要 |

### 方法4: セッションリセット設定

```json
{
  "session": {
    "reset": {
      "mode": "daily",  // または "idle"
      "atHour": 4,  // 毎日4時にリセット
      "idleMinutes": 120  // 120分無操作でリセット
    },
    "resetByType": {
      "thread": { mode: "daily", atHour: 4 }  // スレッドタイプのみリセット
    }
  }
}
```

---

## 💡 タスク単位でセッションを分ける推奨方法

### 推奨：チャンネルベースのタスク管理

Slackのワークフローとして最も自然なのは：
1. **タスクごとに専用チャンネル**を作成（例: `#task-a`, `#task-b`）
2. **各チャンネルでOpenClaw**にタスク指示を出す
3. **チャンネル単位でセッション分離**が自動的に行われる

### 補足：スレッドでの使用

スレッドは、1つのタスク内での詳細なディスカッションに使用すると良いでしょう：
- メインチャンネル: タスクの概要、開始、完了
- スレッド: 詳細な議論、サブタスク

---

## ⚠️ 注意事項

1. **SlackのAPI制限**: チャンネル数には制限がないが、ワークスペースの管理上、多くのチャンネルを作りすぎないように注意
2. **コンテキストの分離**: チャンネルを分けると、タスク間のコンテキスト共有が失われる（これは利点でもあり、欠点でもある）
3. **メンテナンス**: 多くのチャンネルを管理するオーバーヘッドが発生する可能性がある

---

## 📎 結論と推奨事項

### 現時点での技術的な結論

**OpenClawのSlackコネクタは、スレッドごとにセッションを自動的に分ける機能を提供していません。**

Slackではチャンネル単位でのセッション分離がデフォルトであり、スレッドは同じチャンネルセッションの一部として扱われます。

### 推奨事項

| ニーズ | 推奨方法 |
|--------|-----------|
| タスクを明確に分けたい | チャンネルベースでタスク管理 |
| 同一チャンネルで複数のタスクを扱いたい | スレッドで議論、適宜 `/new` でセッションリセット |
| 自動化されたセッション管理 | タスク毎に専用チャンネルを作成し、各チャンネルで `channels.slack.channels.<id>.systemPrompt` でコンテキストを設定 |

---

## 🔧 設定例

### タスクごとにチャンネルを使用する場合

```json
{
  "channels": {
    "slack": {
      "enabled": true,
      "appToken": "xapp-...",
      "botToken": "xoxb-...",
      "channels": {
        "task-a": {
          "allow": true,
          "requireMention": false,
          "systemPrompt": "あなたはタスクAを担当します。このタスクの詳細に特化してください。"
        },
        "task-b": {
          "allow": true,
          "requireMention": false,
          "systemPrompt": "あなたはタスクBを担当します。このタスクの詳細に特化してください。"
        }
      }
    }
  }
}
```

### スレッドでタスクを管理する場合

スレッドでタスクを開始する際、最初に `/new` を送信して新しいセッションを開始することをお勧めします。

---

## 📎 まとめ

- **スレッドごとのセッション自動分けは現在サポートされていない**
- **推奨**: タスクごとに専用チャンネルを使用
- **代替策**: スレッドでタスクを管理し、適宜 `/new` で手動セッションリセット
- **将来**: OpenClawのアップデートでSlackのスレッドごとのセッション分けがサポートされる可能性があるため、リリースノートを確認

---

## 📎 参考リンク

- [Session Management - OpenClaw](https://docs.openclaw.ai/concepts/session)
- [Slack - OpenClaw](https://docs.openclaw.ai/channels/slack)
- [OpenClaw GitHub Issues](https://github.com/openclaw/openclaw/issues)
